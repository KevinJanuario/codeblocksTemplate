parameters:
  - name: enableSonar
    default: false
  - name: buildType
    default: 'c'
  - name: agentPool
    default: Dev
  - name: sourcePath
    default: '.'

stages:
- ${{ if eq(parameters.enableSonar, true) }}:
    - stage: CheckRepository-${{ parameters.buildType }}
      jobs: 
        - job: Sonar-${{ parameters.buildType }}
          pool:
            name: ${{ parameters.agentPool }}
          steps:
            - template: Templates/checks/sonar.yaml

- stage: BuildAndPush-${{ parameters.buildType }}
  jobs:
    - job: Build-${{ parameters.buildType }}
      pool:
        name: ${{ parameters.agentPool }}
      steps:
        - template: Templates/build/checkout.yaml
          parameters:
            buildType: ${{ parameters.buildType }}
            sourcePath: ${{ parameters.sourcePath }}
        - template: Templates/publish/publish.yaml

