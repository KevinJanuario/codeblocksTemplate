parameters:
  - name: buildType
    default: 'c'
 
steps:
- script: |
    docker pull yamandevops/debian:9 
    docker run -d --name $(Build.Repository.Name) -v $(Build.SourcesDirectory):/opt/app -it docker.io/yamandevops/debian:9 /bin/bash
    docker exec $(Build.Repository.Name) bash -c "cd /opt/app/Trunk/C-Fontes/ptptrpro && make -f Makefile.freeimage clean && make -f Makefile.freeimage all"
    # cd /opt/app/Trunk/C-Fontes/ptptrpro
    # make -f Makefile.FreeImage all
    
    repo=perto-${{ parameters.buildType }}
    artefato="$(Build.SourcesDirectory)/Trunk/C-Fontes/ptptrpro/FreeImage.3.15.1/Dist/*.so"

    # Comando curl para enviar o arquivo
    curl -s -w "$(nexusUser):$(nexusPass)" --upload-file "$artefato" "$(nexusHost)/repository/$repo/$(Build.Repository.Name)"

    docker rm -f $(Build.Repository.Name)
 
  displayName: 'Execute Script inside Container'
  condition: succeeded()
  continueOnError: false
 
# - task: PublishBuildArtifacts@1
#   displayName: "Publish image debian 9"
#   condition: succeededOrFailed()
#   inputs:
#     PathtoPublish: "$(Build.ArtifactStagingDirectory)/debian-9"
#     ArtifactName: "debian-9"
#     publishLocation: "Container"