---
parameters:
  - name: buildType
  - name: dotNetProjects
  - name: vcxprojPath

steps:
  - ${{ if eq(parameters.buildType, 'csharp') }}:
      - task: NuGetCommand@2
        inputs:
          restoreSolution: '**\*.sln'
        displayName: 'Restore de dependencias'
      
      - task: MSBuild@1
        inputs:
          solution: '${{ parameters.vcxprojPath }}'
          msbuildArchitecture: 'x64'
          platform: 'Any CPU'
          configuration: 'Release'
          msbuildArguments: '/p:OutDir=$(Build.ArtifactStagingDirectory)\\'
        displayName: 'Build csharp'
  - ${{ if eq(parameters.buildType, 'c') }}:
      - task: SonarQubePrepare@5
        displayName: 'Sonar - Analysis Configuration'
        inputs:
          SonarQube: 'SonarQube'
          scannerMode: 'CLI'
          configMode: 'manual'
          cliProjectKey: $(Build.Repository.Name)
          extraProperties: |
            sonar.exclusions=**/*.bin

  - ${{ if eq(parameters.buildType, 'dotnet') }}:
      - task: SonarQubePrepare@5
        displayName: 'Sonar - Analysis Configuration'
        inputs:
          SonarQube: 'SonarQube'
          scannerMode: 'MSBuild'
          projectKey: '$(Build.Repository.Name)'
      - task: DotNetCoreCLI@2
        displayName: 'Sonar Dotnet Build'
        inputs:
          command: 'build'
          projects: '**/*.${{ parameters.dotNetProjects }}'
          modifyOutputPath: true
          arguments: '--output $(Build.ArtifactStagingDirectory)'

  - task: SonarQubeAnalyze@5
    displayName: 'Sonar - Code Analysis'
    inputs:
      jdkversion: 'JAVA_HOME'

