---
parameters:
  - name: buildType
    default: ''
  - name: dotNetProjects
    default: ''
  - name: vcxprojPath
    default: ''

steps: 
  - ${{ if eq(parameters.buildType, 'c') }}:
      - task: SonarQubePrepare@5
        displayName: 'Sonar - Analysis Configuration'
        inputs:
          SonarQube: 'SonarQube'
          scannerMode: 'CLI'
          configMode: 'manual'
          cliProjectKey: $(Build.Repository.Name)
          extraProperties: |
            sonar.exclusions=**/*.bin

  - ${{ if or(eq(parameters.buildType, 'dotnet'), eq(parameters.buildType, 'csharp')) }}:
      - task: SonarQubePrepare@5
        displayName: 'Sonar - Analysis Configuration'
        inputs:
          SonarQube: 'SonarQube'
          scannerMode: 'MSBuild'
          projectKey: '$(Build.Repository.Name)'
  - ${{ if eq(parameters.buildType, 'dotnet') }}:
      - task: DotNetCoreCLI@2
        displayName: 'Sonar Dotnet Build'
        inputs:
          command: 'build'
          projects: '**/*.${{ parameters.dotNetProjects }}'
          modifyOutputPath: true
          arguments: '--output $(Build.ArtifactStagingDirectory)'

  - task: SonarQubeAnalyze@5
    displayName: 'Sonar - Code Analysis'
    inputs:
      jdkversion: 'JAVA_HOME'

