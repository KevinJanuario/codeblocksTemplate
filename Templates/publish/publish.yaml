---
parameters:
  - name: buildType
    default: 'c'
  - name: publishRepo
    default: 'perto-c'

steps:
  - ${{ if eq(parameters.buildType, 'c') }}:
      - task: PublishBuildArtifacts@1
        inputs:
          pathToPublish: '$(Artifact)'
          artifactName: 'artifact-${{ parameters.buildType }}'
        condition: succeeded()
        displayName: 'Publish Artifacts'


  - bash: |
       set -e
       art=$(Artifact)
       for artifact in $(find $art -type f) ; do
       upload="${artifact#*artifact/}"
       if curl -w  "%{http_code}" -u $(nexusUser):$(nexusPass) --upload-file $artifact "$(nexusHost)/repository/${{ parameters.publishRepo }}/$upload" | grep 201 ; then
          echo "  - $artifact Publicado com sucesso!"
       else
          echo "  [-] Falha ao publicar - $artifact"
          exit 1
       fi
       done
        #curl -u $(nexusUser):$(nexusPass) --upload-file $artifact $(nesusHost)/repository/perto/$artifact
    displayName: 'Upload file to Nexus'
