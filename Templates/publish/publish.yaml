---
parameters:
  - name: buildType

steps:
  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: '$(Artifact)'
      artifactName: 'artifact-${{ parameters.buildType }}'
    condition: succeeded()
    displayName: 'Publish Artifacts'

  - bash: |
       set -e
       repo=perto-${{ parameters.buildType }}
       art=$(Artifact)
       

       for artifact in $(find $art -type f) ; do
       upload="${artifact#*artifact/}"
       if curl -w  "%{http_code}" -u $(nexusUser):$(nexusPass) --upload-file $artifact "$(nexusHost)/repository/$repo/$upload" | grep 201 ; then
          echo "  - $artifact Publicado com sucesso no repositorio $repo!"
       else
          echo "  [-] Falha ao publicar no repositorio $repo - $artifact"
          exit 1
       fi
       done
        #curl -u $(nexusUser):$(nexusPass) --upload-file $artifact $(nesusHost)/repository/perto/$artifact
    displayName: 'Upload file to Nexus'
    condition: succeeded()
