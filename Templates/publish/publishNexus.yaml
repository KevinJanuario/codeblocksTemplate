---
parameters:
  - name: buildType
    default: 'c'

steps:
  - powershell: |
      $api = "$(Build.Repository.Name)"
      $repo = "perto-${{ parameters.buildType }}"
      $authInfo = [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("$(nexusUser):$(nexusPass)"))
      $file = "$(Build.SourcesDirectory)\Trunk\C-Fontes\bin\Windows\Releas*"
 
      # Usar loop para tratar múltiplos arquivos, já que -InFile não suporta wildcard (*.dll)
      Get-ChildItem -Path $file32 | ForEach-Object {
          Invoke-WebRequest -Uri "$(nexusHost)/repository/$repo/$api" -Method Put -Headers @{
              Authorization = "Basic $authInfo"
          } -InFile $_.FullName -UseBasicParsing
      }
    displayName: 'Deploy to Nexus'