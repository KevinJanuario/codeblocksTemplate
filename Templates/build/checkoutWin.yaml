parameters:
  - name: buildTypeWindows
    default: 'c_windows'
  - name: Version
    default: '64'

steps:
  - ${{ if eq(parameters.buildTypeWindows, 'c_windows') }}:
      - powershell: |
          Write-Host "FUNCIONOU!!!!"
          $Version = [int]$env:VERSION

          # Definir o caminho base para a pasta mingw
          $mingwBasePath = "C:\Compiladores\mingw"
          
          # Remover a pasta C:\Compiladores\mingw se ela existir
          if (Test-Path $mingwBasePath) {
              Remove-Item $mingwBasePath -Recurse -Force
              Write-Host "Pasta antiga $mingwBasePath removida."
          }
          
          # Definir o caminho do compilador com base no parâmetro
          $mingwPath = "C:\Compiladores\mingw$Version"
          
          # Verificar se o caminho do compilador existe
          if (-not (Test-Path $mingwPath)) {
              Write-Host "Caminho do compilador não encontrado: $mingwPath"
              exit
          }
          
          # Renomear a pasta do compilador para C:\Compiladores\mingw
          Write-Host "Iniciando cópia para $mingwBasePath"
          Copy-Item -Recurse $mingwPath $mingwBasePath -Verbose
          
          # Executar comandos no CodeBlocks se a versão for 64
          $codeBlocksPath = "C:\Program Files\CodeBlocks\codeblocks.exe"
          $projectFile = "\*.cbp"          
          $projectPath = "$(Pipeline.Workspace)\s\Trunk\C-Fontes\"
          Write-Host "$projectPath"

          # Executar comandos no CodeBlocks
          Push-Location $projectPath
          & $codeBlocksPath --clean $projectFile
          Start-Sleep -Seconds 15
          if ($Version -eq 64) {
              Write-Host "Versão 64 bits selecionada"
              & $codeBlocksPath --build $projectFile --target "DLL x64"
              Pop-Location
          } else {
              Write-Host "Versão 32 bits selecionada"
              & $codeBlocksPath --build $projectFile --target "DLL x86"
              Pop-Location
          }
        displayName: 'Build Windows'
        env:
          VERSION: ${{ parameters.Version }}
